os: linux
dist: bionic
language: generic
addons:
  apt:
    packages:
      - libgmp-dev
env:
  global:
    - HACKAGE_USERNAME=fozworth
    # HACKAGE_PASSWORD
    - secure: VrmoqGX8aKjMEfJc2Me/s3YQomYUxOzW/eL3s2dcK1o829B7NTf3h+8CZIpMtiu9+eomU15EiOcDylfo+bvVBrWLXtgxLb+qJ6m8CZCqc5KbrQb5dIy8M3PNe2OYD/VXKveJE42hRsndTTEyz0aa/2rJCuJvbYPEJJHdgQmLtthwePL2NdVqQyiBT8EU+fJe4e10tVxI2XA2tYH5Y0tuUCxgfAnynZv1I2tDTgIivGtdFGbi5aQq3stInIB51WTYyeCiBcllBRWItVWh5UvjR3R+hKdOj8mMncLed+7z37luryS7X4RaQqkI4lf9Z4CoLncCtLGhPNu4lDa6uf1kapFx8F24isF99lMbTuY9nkagf/vXEENXmjAAhGuNx2p1rRMh3Db9fYDx/3HDL6lABQdf9H3LfW7BIZimzAWXisUAMHllu7m4Vg1RrbaIiSHbNwnxISkgLYhFpVqytExsXwyM2hVkMY5iZYCFJMecBe6ppYZDCfE92d3qXjWQCoik2WU/Dey3rwK7SJhIq2boTJ/xfCvvEK1CwF+ImnG3zJrdyIOEdTLlQ6/eEQm3trL9VZIOLV8Qe4ms4kmvEPIO53ck+FZBI9gCh6rDrpimW8JuVtNNwMtUKbvf7lzHikGAqtEH9sS/uzxxkpVS+eIS1EfqDRaMdDcjPF9mFpwPl74=

cache:
  directories:
    - $HOME/.local/bin
    - $HOME/.stack

before_install:
  - |
    if ! test -f "$HOME/.local/bin/stack"
    then
      VERSION=2.3.0.1
      URL="https://github.com/commercialhaskell/stack/releases/download/v$VERSION/stack-$VERSION-linux-x86_64-static.tar.gz"
      curl --location --output stack.tar.gz "$URL"
      gunzip stack.tar.gz
      tar --extract --file stack.tar --strip-components 1
      mkdir --parents "$HOME/.local/bin"
      mv stack "$HOME/.local/bin"
      rm stack.tar
    fi
  - stack --version

install:
  - stack setup
  - stack build --only-dependencies --test

script:
  - stack build --no-run-tests --pedantic --test
  - stack build --test
  - stack sdist

deploy:
  provider: script
  on:
    tags: true
  skip_cleanup: true
  script: yes | stack upload .
